@model MakeAList.Models.UserList

@{
    ViewData["Title"] = Model.Title;
}

<style>
    .note {
        background: #fff8a6;
        padding: 15px 20px;
        border-radius: 6px;
        margin-bottom: 12px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        border-left: 6px solid #f6d300;
        transition: 0.2s ease;
        cursor: pointer;
    }

    .note:hover {
        transform: scale(1.01);
    }

    .done {
        text-decoration: line-through;
        opacity: 0.5;
    }

    .toggle {
        margin-right: 12px;
        cursor: pointer;
        transform: scale(1.3);
    }
</style>

<h1>@Model.Title</h1>
<p><strong>Type:</strong> @Model.Type</p>

<a class="btn btn-primary" asp-controller="ListItems" asp-action="Create" asp-route-listId="@Model.Id">Add Item</a>

<hr />

<div id="items-container">
    @foreach (var item in Model.Items)
    {
            <div class="note" data-id="@item.Id">
                <input type="checkbox" class="toggle" @(item.IsDone ? "checked" : "") />
                <span class="text @(item.IsDone ? "done" : "")">@item.Text</span>

                <div style="float:right;">
                    <a asp-controller="ListItems" asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                    <a asp-controller="ListItems" asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                </div>
            </div>
    }
</div>


<script>
    document.querySelectorAll('.note .toggle').forEach(cb => {
        cb.addEventListener('change', async (e) => {
            const note = e.target.closest('.note');
            const id = note.dataset.id;

            const response = await fetch('/ToDo/ToggleDone', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            });

            const result = await response.json();

            if (result.success) {
                const text = note.querySelector('.text');
                if (result.isDone) {
                    text.classList.add('done');
                } else {
                    text.classList.remove('done');
                }
            }
        });
    });
</script>
